# MALWARE ANALYSIS
> BTL: Phát triển Malware
- https://github.com/nigmaz/Blogs/tree/main/Reverse-Engineering/Malware%20Analysis
- Phát triển dựa trên malware từ MMHCS, thêm các tính năng
    * Change `Registry` => Use `Services`.
    * Bypass `Windows Defender`.
    * `Pack`.
    * `Anti Virtual Machine`.
    * `Xem có injection được chương trình vàp process có quyền nt-authority không` key search: injection process permisions nt-authrority
    * Một số cách thức lây nhiễm:
        + Mở 1 file tài liệu và connect IP (có thể ngủ đông hoặc mở luôn) => Phishing.
        + `autorun` or `crack app`.
        + xem thêm được `bot net` (Lateral Movement).
        + ...
- Báo cáo theo nguyên tắc hoạt động của malware:
    * Intrusion system
    * Control system
    * Create Backdoor 
    * Thực hiện các hoạt động độc hại
    * Che giấu sự hoạt động (Persistence).

- APT (Advanced Persistent Threat)
- VD của `Australian Embassy`:
    * Create 1 tools tách content .docx and tao 1 file docx mới với content đó, cái form docx cũ bỏ đi (loại bỏ được một số trường hợp như hijack dll,...)
    * Nhược điểm tồn tại là với những file như .exe , .rar , ... gần như bỏ qua hết

- References:
   * https://noventiq.com/security_blog/detecting-guloaders-infection-chain-with-microsoft-sentinel
   * https://attack.mitre.org/
   * https://github.com/rasta-mouse/ThreatCheck
   * https://github.com/mikesiko/PracticalMalwareAnalysis-Labs
   * How to hide malware https://www.youtube.com/watch?si=0lbLFGG9dlPLZ3PJ&v=5cch_-3NVLk&feature=youtu.be
   * https://github.com/nigmaz/Blogs/tree/main/Reverse-Engineering#3-malware-analysis
   * https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1055/T1055.md#atomic-test-1---shellcode-execution-via-vba
   * https://stackoverflow.com/questions/7465396/creating-windows-startup-services-via-reg-or-command-line
   * tạo file conhost.exe fake in windows/system/conhost.exe rồi đính vào registrty
   * Source malware: https://github.com/ytisf/theZoo
   * Dev malware quynx: https://maldevacademy.com/syllabus
   * https://www.ired.team/offensive-security/code-injection-process-injection/backdooring-portable-executables-pe-with-shellcode
   * setdebugprivileged
   * Cho order 1 đĩa infostealer nhiều hành: https://whitehat.vn/threads/infostealer-dai-cuong.17472/
   * Video:
      + https://youtu.be/pbR_BNSOaMk?si=O0uzqAgjYtgeOD31
      + How to bypass Windows 11/10 Defender with Hoaxhsell & AmsiTrigger [UNDETECTED]: https://www.youtube.com/watch?si=pfZAYI3ZehrptQd_&v=oxY5Mw9jvxg&feature=youtu.be
      + https://www.youtube.com/watch?si=gEm193iR5BD4bV-M&v=Sv8yu12y5zM&feature=youtu.be
      + https://www.youtube.com/watch?si=WY615CysxwF5b5QP&v=aNEqC-U5tHM&feature=youtu.be
      + https://www.youtube.com/@crr0ww/videos
      + https://www.youtube.com/watch?v=vq6wNGYzdDE
      + https://www.youtube.com/results?search_query=malware+development+full+course
      + https://www.youtube.com/watch?v=ErPKP4Ms28s
      + https://www.youtube.com/watch?v=eiT7mslA63c
      + https://www.youtube.com/watch?v=YAaTed3FyZI
      + https://www.youtube.com/watch?v=RCutqPF5fLs&t=52s
   * ...
```
explorer.exe
svchost.exe
conhost.exe
Where, uses, ... ?

svchost.exe
=> SYSTEM
=> LocalService
=> NetworkService
=> CurrentUser
```
```
Làm nhiều thì quen tay thoii cuối cùng cần chuẩn hóa thành quy trình.

Trong các hệ điều hành version mới khi thay đổi registry, hệ điều hành khi khơởi động lại sẽ load default KEY lại\

Phân loại không cần vật chủ và cần vật chủ
```

- Clear windows Event Logs Using Command Prompt Windows 10

```batch
for /F "tokens=*"%1('wevtutil.exe el') DO wevtutil.exe cl "%1"
```

